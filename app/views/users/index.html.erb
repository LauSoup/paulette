<div class="container text-align-center">
  <h1>Find your hen!</h1>
  <div class="row d-flex justify-content-center align-items-center">
    <% @users.each do |user| %>
    <div class="col-sm-12 col-md-6 col-lg-4">
      <%= link_to user_path(user) do%>
      <div class="card-product">
        <h6><%= user.hens.where(disponibility: true).length %> 🐓 available!</h6>
        <% if user.photo.attached? %>
          <%= cl_image_tag user.photo.key %>
        <% else %>
          <%= image_tag("https://poulespondeuses.com/wp-content/uploads/2018/02/Tonio-Poule-1080x810.jpg") %>
        <% end %>
        <div class="card-product-infos">
          <h2><%= user.name %></h2>
          <p><%= user.address %></p>
          <div class="text-right">
            <% total = [] %>
            <% user.hens.each do |hen| %>
              <% hen.reviews.each do |review|  %>
              <% total << review.rating %>
              <% end %>
            <% end %>
              <% sum = total.sum %>
              <% size = total.size %>
              <% total = sum.fdiv(size) %>
              <%= total %>
          </div>
        </div>
      </div>
      <% end %>
    </div>
    <% end %>
  </div>
  <div id="map"
     style="width: 100%; height: 600px;"
     data-markers="<%= @markers.to_json %>"
     data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
</div>
